<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12x16 Level Editor</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px
        }

        .palette {
            margin-bottom: 10px
        }

        .palette button {
            margin-right: 5px;
            padding: 5px 10px
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(12, 30px);
            grid-template-rows: repeat(16, 30px);
            gap: 2px
        }

        .cell {
            width: 30px;
            height: 30px;
            border: 1px solid #ccc;
            cursor: pointer;
            background-color: #fff
        }

        .cell.path {
            background-color: lightgray
        }

        .cell.start {
            background-color: lightgreen
        }

        .cell.key {
            background-color: gold
        }

        .cell.chest {
            background-color: peru
        }

        #output {
            width: 100%;
            height: 150px;
            margin-top: 10px
        }
    </style>
</head>

<body>
    <h1>12x16 Level Editor</h1>
    <div class="palette">
        <strong>Selected Tile:</strong>
        <button data-type="path">Path (1)</button>
        <button data-type="start">Start (2)</button>
        <button data-type="key">Key (3)</button>
        <button data-type="chest">Chest (4)</button>
        <button data-type="erase">Erase (0)</button>
    </div>
    <div class="grid" id="editor"></div>
    <button id="exportBtn">Export Level Array</button>
    <textarea id="output" placeholder="Level array will appear here..."></textarea>
    <script>
        (function () {
            const cols = 12;
            const rows = 16;
            let selectedType = 'path';
            const codes = { path: 1, start: 2, key: 3, chest: 4, erase: 0 };
            const gridContainer = document.getElementById('editor');
            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.x = x;
                    cell.dataset.y = y;
                    cell.dataset.type = 'erase';
                    cell.addEventListener('click', (event) => {
                        cell.classList.remove('path', 'start', 'key', 'chest');
                        if (selectedType !== 'erase') cell.classList.add(selectedType);
                        cell.dataset.type = selectedType;
                    });
                    cell.addEventListener('mousemove', (event) => {
                        if (event.buttons > 0) {
                            cell.classList.remove('path', 'start', 'key', 'chest');
                            if (selectedType !== 'erase') cell.classList.add(selectedType);
                            cell.dataset.type = selectedType;
                        }
                    });
                    gridContainer.appendChild(cell);
                }
            }
            document.addEventListener("keydown", (event) => {
                switch (event.code) {
                    case "Digit5":
                        selectedType = "erase";
                        break;
                    case "Digit0":
                        selectedType = "erase";
                        break;
                    case "Digit1":
                        selectedType = "path";
                        break;
                    case "Digit2":
                        selectedType = "start";
                        break;
                    case "Digit3":
                        selectedType = "key";
                        break;
                    case "Digit4":
                        selectedType = "chest";
                        break;
                }
            });
            document.querySelectorAll('.palette button').forEach(btn => {
                btn.addEventListener('click', () => {
                    selectedType = btn.dataset.type;
                    document.querySelectorAll('.palette button').forEach(b => b.style.fontWeight = '');
                    btn.style.fontWeight = 'bold';
                });
            });
            document.querySelector('.palette button[data-type="path"]').style.fontWeight = 'bold';
            document.getElementById('exportBtn').addEventListener('click', () => {
                const json = {
                    zoom: 0.5,
                    startX: 0,
                    startY: 0,
                    keys: 0,
                };
                const array = [];
                for (let y = 0; y < rows; y++) {
                    const row = [];
                    for (let x = 0; x < cols; x++) {
                        const cell = document.querySelector(`.cell[data-x="${x}"][data-y="${y}"]`);
                        if (codes[cell.dataset.type] == 2) {
                            row.push(1);
                            json.startX = x;
                            json.startY = y;
                        } else if (codes[cell.dataset.type] == 3) {
                            row.push(3);
                            json.keys++;
                        }
                        else {
                            row.push(codes[cell.dataset.type] || 0);
                        }
                    }
                    array.push(row);
                }

                json.layout = array;

                document.getElementById('output').value = JSON.stringify(json);
            });
        })();
    </script>
</body>

</html>